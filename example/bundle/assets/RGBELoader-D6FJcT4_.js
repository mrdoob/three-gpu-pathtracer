import{as as z,H as L,F as I,D as b,f as Y,r as N}from"./MaterialBase-BpiTyhsa.js";class $ extends z{constructor(c){super(c),this.type=L}parse(c){const _=function(r,a){switch(r){case 1:throw new Error("THREE.HDRLoader: Read Error: "+(a||""));case 2:throw new Error("THREE.HDRLoader: Write Error: "+(a||""));case 3:throw new Error("THREE.HDRLoader: Bad File Format: "+(a||""));default:case 4:throw new Error("THREE.HDRLoader: Memory Error: "+(a||""))}},M=function(r,a,o){a=a||1024;let s=r.pos,i=-1,e=0,l="",t=String.fromCharCode.apply(null,new Uint16Array(r.subarray(s,s+128)));for(;0>(i=t.indexOf(`
`))&&e<a&&s<r.byteLength;)l+=t,e+=t.length,s+=128,t+=String.fromCharCode.apply(null,new Uint16Array(r.subarray(s,s+128)));return-1<i?(r.pos+=e+i+1,l+t.slice(0,i)):!1},V=function(r){const a=/^#\?(\S+)/,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,e={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,t;for((r.pos>=r.byteLength||!(l=M(r)))&&_(1,"no header found"),(t=l.match(a))||_(3,"bad initial token"),e.valid|=1,e.programtype=t[1],e.string+=l+`
`;l=M(r),l!==!1;){if(e.string+=l+`
`,l.charAt(0)==="#"){e.comments+=l+`
`;continue}if((t=l.match(o))&&(e.gamma=parseFloat(t[1])),(t=l.match(n))&&(e.exposure=parseFloat(t[1])),(t=l.match(s))&&(e.valid|=2,e.format=t[1]),(t=l.match(i))&&(e.valid|=4,e.height=parseInt(t[1],10),e.width=parseInt(t[2],10)),e.valid&2&&e.valid&4)break}return e.valid&2||_(3,"missing format specifier"),e.valid&4||_(3,"missing image size specifier"),e},v=function(r,a,o){const n=a;if(n<8||n>32767||r[0]!==2||r[1]!==2||r[2]&128)return new Uint8Array(r);n!==(r[2]<<8|r[3])&&_(3,"wrong scanline width");const s=new Uint8Array(4*a*o);s.length||_(4,"unable to allocate buffer space");let i=0,e=0;const l=4*n,t=new Uint8Array(4),g=new Uint8Array(l);let k=o;for(;k>0&&e<r.byteLength;){e+4>r.byteLength&&_(1),t[0]=r[e++],t[1]=r[e++],t[2]=r[e++],t[3]=r[e++],(t[0]!=2||t[1]!=2||(t[2]<<8|t[3])!=n)&&_(3,"bad rgbe scanline format");let R=0,h;for(;R<l&&e<r.byteLength;){h=r[e++];const d=h>128;if(d&&(h-=128),(h===0||R+h>l)&&_(3,"bad scanline data"),d){const m=r[e++];for(let f=0;f<h;f++)g[R++]=m}else g.set(r.subarray(e,e+h),R),R+=h,e+=h}const C=n;for(let d=0;d<C;d++){let m=0;s[i]=g[d+m],m+=n,s[i+1]=g[d+m],m+=n,s[i+2]=g[d+m],m+=n,s[i+3]=g[d+m],i+=4}k--}return s},x=function(r,a,o,n){const s=r[a+3],i=Math.pow(2,s-128)/255;o[n+0]=r[a+0]*i,o[n+1]=r[a+1]*i,o[n+2]=r[a+2]*i,o[n+3]=1},P=function(r,a,o,n){const s=r[a+3],i=Math.pow(2,s-128)/255;o[n+0]=b.toHalfFloat(Math.min(r[a+0]*i,65504)),o[n+1]=b.toHalfFloat(Math.min(r[a+1]*i,65504)),o[n+2]=b.toHalfFloat(Math.min(r[a+2]*i,65504)),o[n+3]=b.toHalfFloat(1)},w=new Uint8Array(c);w.pos=0;const E=V(w),T=E.width,u=E.height,y=v(w.subarray(w.pos),T,u);let B,G,p;switch(this.type){case I:p=y.length/4;const r=new Float32Array(p*4);for(let o=0;o<p;o++)x(y,o*4,r,o*4);B=r,G=I;break;case L:p=y.length/4;const a=new Uint16Array(p*4);for(let o=0;o<p;o++)P(y,o*4,a,o*4);B=a,G=L;break;default:throw new Error("THREE.HDRLoader: Unsupported type: "+this.type)}return{width:T,height:u,data:B,header:E.string,gamma:E.gamma,exposure:E.exposure,type:G}}setDataType(c){return this.type=c,this}load(c,D,F,S){function A(_,H){switch(_.type){case I:case L:_.colorSpace=Y,_.minFilter=N,_.magFilter=N,_.generateMipmaps=!1,_.flipY=!0;break}D&&D(_,H)}return super.load(c,A,F,S)}}class q extends ${constructor(c){console.warn("RGBELoader has been deprecated. Please use HDRLoader instead."),super(c)}}export{q as R};
