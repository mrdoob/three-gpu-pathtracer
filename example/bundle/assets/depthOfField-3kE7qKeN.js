import"./modulepreload-polyfill-B5Qt9EMX.js";import{V as P,k as E,at as L,au as R,av as F,ax as G,M as D,U as T,ay as k}from"./MaterialBase-BpiTyhsa.js";import{G as B}from"./GLTFLoader-CQup9ecK.js";import{O as W}from"./OrbitControls-D85FXo-B.js";import{R as H}from"./RGBELoader-D6FJcT4_.js";import{M as V}from"./meshopt_decoder.module-j6OW_3Rk.js";import{g as A}from"./lil-gui.module.min-BH_YJbPT.js";import{g as I}from"./getScaledSettings-nzgggDDj.js";import{L as j}from"./LoaderElement-kg8-0xPv.js";import{P as z}from"./ParallelMeshBVHWorker-C3soLrCh.js";import{P as O}from"./PathTracingRenderer-BPwEUhqE.js";import{W as U,G as _}from"./WebGLPathTracer-Cpus8pis.js";import{B as q}from"./BlurredEnvMapGenerator-91C7xz75.js";import"./BufferGeometryUtils-CVTBXag-.js";import"./pcg.glsl-DWfbdcxb.js";import"./ggx_functions.glsl-BPuHaSoe.js";const X="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr",Y="https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/sd-macross-city-standoff-diorama/scene.glb",N="Model by tipatat on Sketchfab",J="Path tracing with configurable bokeh and depth of field. Click point in scene to focus.";let t,o,p,e,d,w,m;const g=new P,C=new E,r={bounces:3,renderScale:1/window.devicePixelRatio,filterGlossyFactor:.5,tiles:1,autoFocus:!0,...I()};K();async function K(){m=new j,m.attach(document.body),o=new L({antialias:!0}),o.toneMapping=R,document.body.appendChild(o.domElement),t=new U(o),t.setBVHWorker(new z),t.tiles.set(r.tiles,r.tiles),e=new O(60,window.innerWidth/window.innerHeight,.025,500),e.position.set(-.262,.5276,-1.1606),e.apertureBlades=6,e.fStop=.6,e.focusDistance=1.1878,C.set(-.5253353217832674,.3031596413506029,.000777794185259223);const n=new _;n.topColor.set(3739424).convertSRGBToLinear(),n.bottomColor.set(1383199).convertSRGBToLinear(),n.update(),d=new F,d.background=n,d.environmentIntensity=.5,p=new W(e,o.domElement),p.target.set(-.182,.147,.06),p.update(),p.addEventListener("change",()=>{r.autoFocus&&(e.focusDistance=e.position.distanceTo(C)-e.near),t.updateCamera()});const[u,c]=await Promise.all([new H().loadAsync(X),new B().setMeshoptDecoder(V).loadAsync(Y)]),l=new q(o),S=l.generate(u,.35);l.dispose(),u.dispose(),d.environment=S;const v=new G(1,10,10),x=new D({emissiveIntensity:10,emissive:16777215});for(let a=0;a<300;a++){const f=new T(v,x);f.scale.setScalar(.075*Math.random()+.03),f.position.randomDirection().multiplyScalar(30+Math.random()*15),d.add(f)}c.scene.scale.setScalar(.5),c.scene.traverse(a=>{a.material&&(a.material.roughness=.05,a.material.metalness=.05)}),d.add(c.scene),d.updateMatrixWorld(!0),w=(await t.setSceneAsync(d,e,{onProgress:a=>m.setPercentage(a)})).bvh,m.setCredits(N),m.setDescription(J),s(),b(),window.addEventListener("resize",b),o.domElement.addEventListener("mouseup",Z),o.domElement.addEventListener("mousedown",Q);const y=new A,h=y.addFolder("Path Tracer");h.add(r,"tiles",1,4,1).onChange(a=>{t.tiles.set(a,a)}),h.add(r,"bounces",1,30,1).onChange(s),h.add(r,"renderScale",.1,1).onChange(s);const i=y.addFolder("Camera");i.add(e,"focusDistance",1,100).onChange(s).listen(),i.add(e,"apertureBlades",0,10,1).onChange(function(a){e.apertureBlades=a===0?0:Math.max(a,3),this.updateDisplay(),s()}),i.add(e,"apertureRotation",0,12.5).onChange(s),i.add(e,"anamorphicRatio",.1,10).onChange(s),i.add(e,"bokehSize",0,100).onChange(s).listen(),i.add(e,"fStop",.02,20).onChange(s).listen(),i.add(e,"fov",25,100).onChange(()=>{e.updateProjectionMatrix(),t.updateCamera()}).listen(),i.add(r,"autoFocus"),M()}function Q(n){g.set(n.clientX,n.clientY)}function Z(n){if(Math.abs(g.x-n.clientX)+Math.abs(g.y-n.clientY)<2&&w){const c=new k;c.setFromCamera({x:n.clientX/window.innerWidth*2-1,y:-(n.clientY/window.innerHeight)*2+1},e);const l=w.raycastFirst(c.ray);l&&(C.copy(l.point),e.focusDistance=l.distance-e.near,t.updateCamera())}}function b(){o.setSize(window.innerWidth,window.innerHeight),o.setPixelRatio(window.devicePixelRatio),e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),t.updateCamera()}function s(){t.filterGlossyFactor=r.filterGlossyFactor,t.bounces=r.bounces,t.renderScale=r.renderScale,t.updateCamera(),t.reset()}function M(){requestAnimationFrame(M),t.renderSample(),m.setSamples(t.samples,t.isCompiling)}
