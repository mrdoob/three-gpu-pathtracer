import"./modulepreload-polyfill-B5Qt9EMX.js";import{at as z,au as C,a0 as P,av as F,$ as U,E as j,aG as k,ag as B,k as b}from"./MaterialBase-BpiTyhsa.js";import{G as W}from"./GLTFLoader-CQup9ecK.js";import{O as A}from"./OrbitControls-D85FXo-B.js";import{R as O}from"./RGBELoader-D6FJcT4_.js";import{g as D}from"./getScaledSettings-nzgggDDj.js";import{L as H}from"./LoaderElement-kg8-0xPv.js";import{W as I}from"./WebGLPathTracer-Cpus8pis.js";import"./BufferGeometryUtils-CVTBXag-.js";import"./pcg.glsl-DWfbdcxb.js";import"./PathTracingRenderer-BPwEUhqE.js";import"./ggx_functions.glsl-BPuHaSoe.js";const _="https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/chinese_garden_1k.hdr";let n,i,d,e,o,l,c,L=!1;const s=document.getElementById("drop-zone");q();async function q(){const{tiles:h,renderScale:T}=D();l=new H,l.attach(document.body),i=new z({antialias:!0}),i.toneMapping=C,i.toneMappingExposure=.5,document.body.appendChild(i.domElement),n=new I(i),n.filterGlossyFactor=.5,n.renderScale=T,n.tiles.set(h,h),e=new P(50,window.innerWidth/window.innerHeight,.025,500),e.position.set(0,0,4),o=new F,o.backgroundBlurriness=.05,o.environmentIntensity=3,c=new U,o.add(c),d=new A(e,i.domElement),d.addEventListener("change",()=>n.updateCamera()),d.update();const v=await new O().loadAsync(_).then(a=>(a.mapping=j,a));o.background=v,o.environment=v,n.setScene(o,e),l.setPercentage(1),window.addEventListener("resize",x),window.addEventListener("dragover",a=>{a.preventDefault(),L||s.classList.add("drag-over")}),window.addEventListener("dragleave",a=>{(a.relatedTarget===null||a.relatedTarget===document.documentElement)&&s.classList.remove("drag-over")}),window.addEventListener("drop",a=>{a.preventDefault(),s.classList.remove("drag-over");const m=a.dataTransfer.files;if(m.length>0){s.innerText="Loading...",s.classList.remove("hidden");const p=new Map;let g=null;for(const t of m){const r=URL.createObjectURL(t);p.set(t.name,r),t.name.match(/\.gltf$/i)&&(g=r)}const E=new k;E.setURLModifier(t=>p.get(t.split("/").pop())||t);const M=new W(E),R=t=>{c.clear(),c.add(t.scene);const r=new B().setFromObject(t.scene),w=r.getCenter(new b),f=r.getSize(new b);t.scene.position.sub(w);const u=Math.max(f.x,f.y,f.z),G=e.fov*(Math.PI/180);e.position.z=u/(2*Math.tan(G/2)),e.position.z*=1.5,e.near=u/100,e.far=u*10,e.updateProjectionMatrix(),d.target.set(0,0,0),d.update(),n.setScene(o,e),s.innerText="Drop GLTF/GLB file here",s.classList.add("hidden"),L=!0,p.forEach(y=>URL.revokeObjectURL(y))};if(g)M.load(g,R);else{const t=m[0],r=new FileReader;r.onload=w=>{M.parse(w.target.result,"",R)},r.readAsArrayBuffer(t)}}}),x(),S()}function x(){i.setSize(window.innerWidth,window.innerHeight),i.setPixelRatio(window.devicePixelRatio),e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),n.updateCamera()}function S(){requestAnimationFrame(S),L&&(n.renderSample(),l.setSamples(n.samples,n.isCompiling))}
