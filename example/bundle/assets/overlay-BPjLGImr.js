import"./modulepreload-polyfill-B5Qt9EMX.js";import{at as E,au as G,a0 as L,av as C,E as F,ag as R,aA as y,M as W,C as A,U as g,A as h,az as j}from"./MaterialBase-BpiTyhsa.js";import{O as T}from"./OrbitControls-D85FXo-B.js";import{R as k}from"./RGBELoader-D6FJcT4_.js";import{g as B}from"./lil-gui.module.min-BH_YJbPT.js";import{G as D}from"./GLTFLoader-CQup9ecK.js";import{M as O}from"./meshopt_decoder.module-j6OW_3Rk.js";import{P as H}from"./ParallelMeshBVHWorker-C3soLrCh.js";import{g as I}from"./getScaledSettings-nzgggDDj.js";import{L as z}from"./LoaderElement-kg8-0xPv.js";import{W as _}from"./WebGLPathTracer-Cpus8pis.js";import"./BufferGeometryUtils-CVTBXag-.js";import"./pcg.glsl-DWfbdcxb.js";import"./PathTracingRenderer-BPwEUhqE.js";import"./ggx_functions.glsl-BPuHaSoe.js";const q="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr",U="https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/sd-macross-city-standoff-diorama/scene.glb",V="Model by tipatat on Sketchfab";let e,t,m,o,r,f,p,c;const n={bounces:5,renderScale:1/window.devicePixelRatio,filterGlossyFactor:.5,tiles:1,multipleImportanceSampling:!0,enabled:!0,...I()};N();async function N(){c=new z,c.attach(document.body),t=new E({antialias:!0}),t.toneMapping=G,document.body.appendChild(t.domElement),e=new _(t),e.tiles.set(n.tiles,n.tiles),e.setBVHWorker(new H),r=new L(75,window.innerWidth/window.innerHeight,.025,500),r.position.set(2.996,3.795,.697),m=new T(r,t.domElement),m.target.set(.311,1.13,.489),m.addEventListener("change",()=>e.updateCamera()),m.update(),o=new C,f=new C;const[a,s]=await Promise.all([new k().loadAsync(q),new D().setMeshoptDecoder(O).loadAsync(U)]);a.mapping=F,o.background=a,o.environment=a;const M=new R;s.scene.traverse(i=>{i.material&&(i.material.map=null)}),s.scene.updateMatrixWorld(!0),M.setFromObject(s.scene),s.scene.position.y-=M.min.y,o.add(s.scene);const P=new y(3.5,3.5,.05,60),v=new W({color:new A(10066329),metalness:.2,roughness:.02}),b=new g(P,v);b.position.y=-.025,o.add(b),p=[];const u=new g(new y(.5,.5,.5,32),new h({color:16711680})),w=new g(new j(.3,.3,.3),new h({color:65280}));u.position.set(-1,0,1),w.position.set(1,0,-1),p.push(u,w),f.add(u,w),await e.setSceneAsync(o,r,{onProgress:i=>{c.setPercentage(i)}}),c.setCredits(V);const l=new B().addFolder("Path Tracer");l.add(n,"tiles",1,4,1).onChange(i=>{e.tiles.set(i,i)}),l.add(n,"filterGlossyFactor",0,1).onChange(d),l.add(n,"bounces",1,15,1).onChange(d),l.add(n,"renderScale",.1,1).onChange(d),l.add(n,"multipleImportanceSampling").onChange(d),l.close(),d(),S(),window.addEventListener("resize",S),x()}function d(){e.filterGlossyFactor=n.filterGlossyFactor,e.bounces=n.bounces,e.renderScale=n.renderScale,e.multipleImportanceSampling=n.multipleImportanceSampling}function S(){t.setSize(window.innerWidth,window.innerHeight),t.setPixelRatio(window.devicePixelRatio),r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix(),e.updateCamera()}const J=new h({colorWrite:!1});function K(){for(let a=0;a<p.length;a++){const s=p[a];s.position.y=Math.sin(Date.now()*.001+a)}}function x(){requestAnimationFrame(x),K(),e.renderSample();const a=t.autoClear;t.autoClear=!1,o.overrideMaterial=J,t.clearDepth(),t.render(o,r),o.overrideMaterial=null,t.render(f,r),t.autoClear=a,c.setSamples(e.samples,e.isCompiling)}
